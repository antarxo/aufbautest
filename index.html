<!DOCTYPE html>
<html lang="el">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Κανόνας Aufbau</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
      body { 
        text-align: center; 
        font-family: Verdana, sans-serif; 
        background-color: #f0f8ff;
      }

      #mainContainer {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0 auto;
        width: 400px; /* Ίδιο πλάτος με τον καμβά και τον πίνακα */
      }

      h1 {
        width: 100%;
        text-align: center;
        color: #2E8B57;
      }

      #controls {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        margin: 10px 0;
      }

      #controls label,
      #controls input,
      #controls button {
        margin: 0 5px;
      }

      #canvasContainer {
        display: flex;
        justify-content: center;
        margin: 20px 0;
      }

      canvas { 
        border: 2px solid #4CAF50;
        border-radius: 10px;
        /* Αφαιρέσαμε το padding για να μην επηρεάζεται η διάταξη */
      }

      button { 
        padding: 10px 20px; 
        background-color: #4CAF50; 
        color: white; 
        border: none; 
        border-radius: 5px;
        cursor: pointer;
      }

      button:hover {
        background-color: #45a049;
      }

      #infoTable {
        margin: 20px 0;
        border-collapse: collapse;
        width: 100%;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        background-color: white;
      }

      #infoTable th,
      #infoTable td {
        border: 2px solid #4CAF50;
        padding: 8px;
        text-align: center;
      }

      #infoTable th {
        background-color: #4CAF50;
        color: white;
        font-size: 14px;
      }

      #infoTable td {
        font-size: 12px;
      }

      .element-symbol {
        font-size: 24px;
        font-weight: bold;
        color: darkgreen;
        margin-right: 10px;
      }

      .element-symbol::before {
        content: attr(data-z);
        font-size: 14px;
        color: red;
        vertical-align: baseline;
        margin-right: 5px;
      }

      #titleContainer {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 20px;
      }

      #titleTable {
        border-collapse: collapse;
      }

      #titleTable td {
        border: none;
        padding: 0;
      }

      #titleText {
        font-size: 20px;
        font-weight: bold;
      }

      #elementSymbolText {
        font-size: 16px;
        font-weight: bold;
        margin-left: 5px;
      }
    </style>
  </head>
  <body>
    <div id="mainContainer">
      <h1>
        Κανόνας Aufbau 
        <span id="elementSymbol" class="element-symbol" data-z=""></span>
      </h1>
      <div id="controls">
        <label for="atomicNumber" style="font-size: 16px;">Z:</label>
        <input
          type="number"
          id="atomicNumber"
          min="1"
          max="118"
          value="1"
          style="padding: 5px;"
        />
        <button onclick="startFilling()">Έναρξη</button>
        <button onclick="resetDiagram()">Reset</button>
      </div>

      <table id="infoTable">
        <tr>
          <th colspan="2">
            Περίοδος: <span id="periodValue">-</span> | Ομάδα:
            <span id="groupValue">-</span>
          </th>
        </tr>
        <tr>
          <td><strong>Αρχική Διαμόρφωση</strong></td>
          <td id="initialConfig">-</td>
        </tr>
        <tr>
          <td><strong>Τελική Διαμόρφωση</strong></td>
          <td id="finalConfig">-</td>
        </tr>
      </table>

      <div id="titleContainer">
        <table id="titleTable">
          <tr>
            <td id="titleText">Ηλεκτρονιακή δόμηση</td>
            <td id="elementSymbolText"></td>
          </tr>
        </table>
      </div>

      <div id="canvasContainer"></div>
    </div>

    <script>
      /* Ορισμοί παραμέτρων για πιο συμπαγή διάταξη */
      const boxWidth = 60,
        boxHeight = 40,
        verticalSpacing = 35,
        horizontalGap = 5,
        canvasWidth = 350,
        canvasHeight = 300,
        periodLabelWidth = 50;
      
      const startY = 30; // Μειωμένη αρχική θέση στον κατακόρυφο άξονα
      const xOffset = 40; // Μειωμένο οριζόντιο offset για όλα τα στοιχεία

      // Ορισμός των περιόδων και των τροχιακών
      const periods = [
        { label: "K", orbitals: ["1s"] },
        { label: "L", orbitals: ["2s", "2p"] },
        { label: "M", orbitals: ["3s", "3p", "3d"] },
        { label: "N", orbitals: ["4s", "4p", "4d", "4f"] },
        { label: "O", orbitals: ["5s", "5p", "5d", "5f"] },
        { label: "P", orbitals: ["6s", "6p", "6d"] },
        { label: "Q", orbitals: ["7s", "7p"] }
      ];

      const fillOrder = [0, 1, 2, 3, 4, 6, 5, 7, 10, 8, 11, 14, 9, 12, 15, 17, 13, 16, 18]; // Σωστή σειρά

      const exceptions = {
        24: { from: "4s", to: "3d", amount: 1 }, // Cr
        29: { from: "4s", to: "3d", amount: 1 }, // Cu
        47: { from: "5s", to: "4d", amount: 1 }, // Ag
        79: { from: "6s", to: "5d", amount: 1 }  // Au
      };

      const elementSymbols = {
        1: "H", 2: "He", 3: "Li", 4: "Be", 5: "B", 6: "C", 7: "N", 8: "O", 9: "F", 10: "Ne",
        11: "Na", 12: "Mg", 13: "Al", 14: "Si", 15: "P", 16: "S", 17: "Cl", 18: "Ar",
        19: "K", 20: "Ca", 21: "Sc", 22: "Ti", 23: "V", 24: "Cr", 25: "Mn", 26: "Fe",
        27: "Co", 28: "Ni", 29: "Cu", 30: "Zn", 31: "Ga", 32: "Ge", 33: "As", 34: "Se",
        35: "Br", 36: "Kr", 37: "Rb", 38: "Sr", 39: "Y", 40: "Zr", 41: "Nb", 42: "Mo",
        43: "Tc", 44: "Ru", 45: "Rh", 46: "Pd", 47: "Ag", 48: "Cd", 49: "In", 50: "Sn",
        51: "Sb", 52: "Te", 53: "I", 54: "Xe", 55: "Cs", 56: "Ba", 57: "La", 58: "Ce",
        59: "Pr", 60: "Nd", 61: "Pm", 62: "Sm", 63: "Eu", 64: "Gd", 65: "Tb", 66: "Dy",
        67: "Ho", 68: "Er", 69: "Tm", 70: "Yb", 71: "Lu", 72: "Hf", 73: "Ta", 74: "W",
        75: "Re", 76: "Os", 77: "Ir", 78: "Pt", 79: "Au", 80: "Hg", 81: "Tl", 82: "Pb",
        83: "Bi", 84: "Po", 85: "At", 86: "Rn", 87: "Fr", 88: "Ra", 89: "Ac", 90: "Th",
        91: "Pa", 92: "U", 93: "Np", 94: "Pu", 95: "Am", 96: "Cm", 97: "Bk", 98: "Cf",
        99: "Es", 100: "Fm", 101: "Md", 102: "No", 103: "Lr", 104: "Rf", 105: "Db",
        106: "Sg", 107: "Bh", 108: "Hs", 109: "Mt", 110: "Ds", 111: "Rg", 112: "Cn",
        113: "Nh", 114: "Fl", 115: "Mc", 116: "Lv", 117: "Ts", 118: "Og"
      };

      let positions = [];
      let columnColors = [];
      let electronCounter = 0;

      // Δημιουργία καμβά με τις νέες διαστάσεις
      function setup() {
        const canvas = createCanvas(canvasWidth, canvasHeight);
        canvas.parent("canvasContainer");
        textSize(12);
        textFont("Verdana");
        initColumnColors();
        calculatePositions();
        noLoop();
      }

      function draw() {
        background(255);
        drawPeriodLabels();
        drawOrbitals();
        drawArrows();
        updateTitleAndSymbol();
      }

      function updateTitleAndSymbol() {
        const Z = parseInt(document.getElementById("atomicNumber").value);
        const elementSymbol = elementSymbols[Z] || "";
        document.getElementById("elementSymbolText").textContent = `${Z} ${elementSymbol}`;
      }

      function drawArrows() {
        stroke(150);
        strokeWeight(2);
        drawingContext.setLineDash([5, 5]);
        for (let i = 0; i < fillOrder.length - 1; i++) {
          let from = positions[fillOrder[i]];
          let to = positions[fillOrder[i + 1]];
          if (to.y > from.y) {
            drawArrow(
              from.x + boxWidth + xOffset,
              from.y + 10,
              to.x + boxWidth + xOffset,
              to.y + 10
            );
          }
        }
        stroke(255, 0, 0);
        drawingContext.setLineDash([]);
        let lastFilledIndex = -1;
        for (let i = fillOrder.length - 1; i >= 0; i--) {
          let idx = fillOrder[i];
          if (positions[idx].filled > 0) {
            lastFilledIndex = i;
            break;
          }
        }
        // Καθυστέρηση για τα κόκκινα βέλη
        for (let i = 0; i < lastFilledIndex; i++) {
          setTimeout(() => {
            let from = positions[fillOrder[i]];
            let to = positions[fillOrder[i + 1]];
            if (to.y > from.y) {
              drawArrow(
                from.x + boxWidth + xOffset,
                from.y + 10,
                to.x + boxWidth + xOffset,
                to.y + 10
              );
            }
          }, i * 500);
        }
      }

      function drawArrow(x1, y1, x2, y2) {
        line(x1, y1, x2, y2);
        let angle = atan2(y2 - y1, x2 - x1);
        push();
        translate(x2, y2);
        rotate(angle);
        let arrowSize = 7;
        triangle(-arrowSize, arrowSize / 2, -arrowSize, -arrowSize / 2, 0, 0);
        pop();
      }

      function initColumnColors() {
        columnColors = [
          color("#FFCDD2"), // s
          color("#C8E6C9"), // p
          color("#BBDEFB"), // d
         
