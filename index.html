<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aufbau</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { text-align: center; font-family: Verdana, sans-serif; }
    canvas { display: block; margin: auto; }
    button { margin: 5px; padding: 10px 20px; font-size: 14px; }
    #infoTable {
      margin-top: 20px;
      font-size: 14px;
      font-weight: normal;
      border-collapse: collapse;
      width: 50%;
      margin-left: auto;
      margin-right: auto;
    }
    #infoTable th, #infoTable td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
    }
    #infoTable th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <h1>Aufbau</h1>
  <label for="atomicNumber">Ατομικός Αριθμός:</label>
  <input type="number" id="atomicNumber" min="1" max="118" value="1">
  <button onclick="startFilling()">Ξεκίνα Δόμηση</button>
  <button onclick="resetDiagram()">Reset</button>
  <div id="elementInfo"></div>
  <table id="infoTable">
    <tr>
      <td>Περίοδος</td>
      <td id="periodInfo"></td>
    </tr>
    <tr>
      <td>Ομάδα</td>
      <td id="groupInfo"></td>
    </tr>
    <tr>
      <td>Σύμβολο Στοιχείου</td>
      <td id="elementSymbol"></td>
    </tr>
    <tr>
      <td>Αρχικό aufbau</td>
      <td id="electronConfigInfo"></td>
    </tr>
  </table>

  <script>
    const elements = [
      { symbol: "H", name: "Υδρογόνο" },
      { symbol: "He", name: "Ήλιο" },
      { symbol: "Li", name: "Λίθιο" },
      { symbol: "Be", name: "Βηρύλλιο" },
      { symbol: "B", name: "Βόριο" },
      { symbol: "C", name: "Άνθρακας" },
      { symbol: "N", name: "Άζωτο" },
      { symbol: "O", name: "Οξυγόνο" },
      { symbol: "F", name: "Φθόριο" },
      { symbol: "Ne", name: "Νέον" },
      { symbol: "Na", name: "Νάτριο" },
      { symbol: "Mg", name: "Μαγνήσιο" },
      { symbol: "Al", name: "Αλουμίνιο" },
      { symbol: "Si", name: "Πυρίτιο" },
      { symbol: "P", name: "Φώσφορος" },
      { symbol: "S", name: "Θείο" },
      { symbol: "Cl", name: "Χλώριο" },
      { symbol: "Ar", name: "Αργό" },
      { symbol: "K", name: "Κάλιο" },
      { symbol: "Ca", name: "Ασβέστιο" },
      { symbol: "Sc", name: "Σκάνδιο" },
      { symbol: "Ti", name: "Τιτάνιο" },
      { symbol: "V", name: "Βανάδιο" },
      { symbol: "Cr", name: "Χρώμιο" },
      { symbol: "Mn", name: "Μαγγάνιο" },
      { symbol: "Fe", name: "Σίδηρος" },
      { symbol: "Co", name: "Κοβάλτιο" },
      { symbol: "Ni", name: "Νικέλιο" },
      { symbol: "Cu", name: "Χαλκός" },
      { symbol: "Zn", name: "Ψευδάργυρος" },
      { symbol: "Ga", name: "Γάλλιο" },
      { symbol: "Ge", name: "Γερμάνιο" },
      { symbol: "As", name: "Αρσενικό" },
      { symbol: "Se", name: "Σελήνιο" },
      { symbol: "Br", name: "Βρώμιο" },
      { symbol: "Kr", name: "Κρυπτό" },
      { symbol: "Rb", name: "Ρουβίδιο" },
      { symbol: "Sr", name: "Στρόντιο" },
      { symbol: "Y", name: "Ύττριο" },
      { symbol: "Zr", name: "Ζιρκόνιο" },
      { symbol: "Nb", name: "Νιόβιο" },
      { symbol: "Mo", name: "Μολυβδαίνιο" },
      { symbol: "Tc", name: "Τεχνήτιο" },
      { symbol: "Ru", name: "Ρουθήνιο" },
      { symbol: "Rh", name: "Ρόδιο" },
      { symbol: "Pd", name: "Παλλάδιο" },
      { symbol: "Ag", name: "Άργυρος" },
      { symbol: "Cd", name: "Κάδμιο" },
      { symbol: "In", name: "Ίνδιο" },
      { symbol: "Sn", name: "Κασσίτερος" },
      { symbol: "Sb", name: "Αντιμόνιο" },
      { symbol: "Te", name: "Τελλούριο" },
      { symbol: "I", name: "Ιώδιο" },
      { symbol: "Xe", name: "Ξένο" },
      { symbol: "Cs", name: "Καίσιο" },
      { symbol: "Ba", name: "Βάριο" },
      { symbol: "La", name: "Λανθάνιο" },
      { symbol: "Ce", name: "Κερίο" },
      { symbol: "Pr", name: "Πρασεοδύμιο" },
      { symbol: "Nd", name: "Νεοδύμιο" },
      { symbol: "Pm", name: "Προμήθιο" },
      { symbol: "Sm", name: "Σαμάριο" },
      { symbol: "Eu", name: "Ευρώπιο" },
      { symbol: "Gd", name: "Γαδολίνιο" },
      { symbol: "Tb", name: "Τέρβιο" },
      { symbol: "Dy", name: "Δυσπρόσιο" },
      { symbol: "Ho", name: "Όλμιο" },
      { symbol: "Er", name: "Έρβιο" },
      { symbol: "Tm", name: "Θούλιο" },
      { symbol: "Yb", name: "Υττέρβιο" },
      { symbol: "Lu", name: "Λουτέτσιο" },
      { symbol: "Hf", name: "Άφνιο" },
      { symbol: "Ta", name: "Ταντάλιο" },
      { symbol: "W", name: "Βολφράμιο" },
      { symbol: "Re", name: "Ρήνιο" },
      { symbol: "Os", name: "Όσμιο" },
      { symbol: "Ir", name: "Ιρίδιο" },
      { symbol: "Pt", name: "Πλατίνα" },
      { symbol: "Au", name: "Χρυσός" },
      { symbol: "Hg", name: "Υδράργυρος" },
      { symbol: "Tl", name: "Θάλλιο" },
      { symbol: "Pb", name: "Μόλυβδος" },
      { symbol: "Bi", name: "Βισμούθιο" },
      { symbol: "Po", name: "Πολώνιο" },
      { symbol: "At", name: "Άστατο" },
      { symbol: "Rn", name: "Ραδόνιο" },
      { symbol: "Fr", name: "Φράνκιο" },
      { symbol: "Ra", name: "Ράδιο" },
      { symbol: "Ac", name: "Ακτίνιο" },
      { symbol: "Th", name: "Θόριο" },
      { symbol: "Pa", name: "Πρωτακτίνιο" },
      { symbol: "U", name: "Ουράνιο" },
      { symbol: "Np", name: "Νεπτούνιο" },
      { symbol: "Pu", name: "Πλουτώνιο" },
      { symbol: "Am", name: "Αμερίκιο" },
      { symbol: "Cm", name: "Κουρίο" },
      { symbol: "Bk", name: "Μπερκέλιο" },
      { symbol: "Cf", name: "Καλιφόρνιο" },
      { symbol: "Es", name: "Αϊνστάινιο" },
      { symbol: "Fm", name: "Φέρμιο" },
      { symbol: "Md", name: "Μενδελέβιο" },
      { symbol: "No", name: "Νομπέλιο" },
      { symbol: "Lr", name: "Λωρένσιο" },
      { symbol: "Rf", name: "Ραδερφόρδιο" },
      { symbol: "Db", name: "Ντούμπνιο" },
      { symbol: "Sg", name: "Σίμποργκιο" },
      { symbol: "Bh", name: "Μποχρίο" },
      { symbol: "Hs", name: "Χάσιο" },
      { symbol: "Mt", name: "Μάιτνεριο" },
      { symbol: "Ds", name: "Νταρμστάντιο" },
      { symbol: "Rg", name: "Ρεντγκένιο" },
      { symbol: "Cn", name: "Κοπέρνικιο" },
      { symbol: "Nh", name: "Νιχόνιο" },
      { symbol: "Fl", name: "Φλερόβιο" },
      { symbol: "Mc", name: "Μοσκόβιο" },
      { symbol: "Lv", name: "Λιβερμόριο" },
      { symbol: "Ts", name: "Τενεσσίνο" },
      { symbol: "Og", name: "Ογκανέσσιο" }
    ];

    const periods = [
      { label: "K", orbitals: ["1s"] },
      { label: "L", orbitals: ["2s", "2p"] },
      { label: "M", orbitals: ["3s", "3p", "3d"] },
      { label: "N", orbitals: ["4s", "4p", "4d", "4f"] },
      { label: "O", orbitals: ["5s", "5p", "5d", "5f"] },
      { label: "P", orbitals: ["6s", "6p", "6d"] },
      { label: "Q", orbitals: ["7s", "7p"] }
    ];

    const maxElectrons = { "s": 2, "p": 6, "d": 10, "f": 14 };
    const boxWidth = 60, boxHeight = 40, verticalSpacing = 45;
    const horizontalGap = 5;
    const canvasWidth = 800, canvasHeight = 500;
    const leftMargin = 120;
    const periodLabelWidth = 50;
    const fillOrder = [0, 1, 2, 3, 4, 6, 5, 7, 10, 8, 11, 14, 9, 12, 15, 17, 13, 16, 18];

    let positions = [];
    let columnColors = [];
    let lastFilledS = null;
    let lastFilledP = null;
    let lastPeriod = -1;

    function setup() {
      createCanvas(canvasWidth, canvasHeight);
      textSize(12);
      textFont("Verdana");
      initColumnColors();
      calculatePositions();
      noLoop();
    }

    function draw() {
      background(255);
      drawPeriodLabels();
      drawOrbitals();
      drawArrows();
    }

    function initColumnColors() {
      columnColors = [
        color("#FFCDD2"), // στήλη 0
        color("#C8E6C9"), // στήλη 1
        color("#BBDEFB"), // στήλη 2
        color("#FFF9C4"), // στήλη 3
        color("#D1C4E9")  // στήλη 4
      ];
    }

    function calculatePositions() {
      positions = [];
      let startY = 50;
      for (let i = 0; i < periods.length; i++) {
        let rowOrbitals = periods[i].orbitals;
        let startX = leftMargin + periodLabelWidth;
        let y = startY + i * verticalSpacing;
        for (let j = 0; j < rowOrbitals.length; j++) {
          let x = startX + j * (boxWidth + horizontalGap);
          positions.push({ x: x, y: y, label: rowOrbitals[j], filled: 0, col: j });
        }
      }
    }

    function drawPeriodLabels() {
      let periodElectrons = new Array(periods.length).fill(0);
      for (let pos of positions) {
        let periodIndex = periods.findIndex(p => p.orbitals.includes(pos.label));
        if (periodIndex !== -1) {
          periodElectrons[periodIndex] += pos.filled;
        }
      }

      textAlign(RIGHT, CENTER);
      fill(0);
      textSize(14);
      textStyle(BOLD);
      for (let i = 0; i < periods.length; i++) {
        let y = 50 + i * verticalSpacing;
        if (periodElectrons[i] > 0) {
          text(periods[i].label + " (" + periodElectrons[i] + ")", leftMargin - 10, y);
        } else {
          text(periods[i].label, leftMargin - 10, y);
        }
      }
      textStyle(NORMAL);
      textSize(12);
    }

    function drawOrbitals() {
      noStroke();
      textAlign(CENTER, CENTER);
      for (let pos of positions) {
        let colIndex = pos.col;
        let colColor = columnColors[colIndex % columnColors.length];

        // Change color to gray for the last filled s and p orbitals of the last period
        if (pos.isGray) {
          colColor = color(200); // Gray color
        }

        fill(colColor);
        rectMode(CENTER);
        rect(pos.x, pos.y, boxWidth, boxHeight);
        fill(0);

        if (pos.filled > 0) {
          let label = pos.label;
          let exponent = pos.filled;
          let labelWidth = textWidth(label);

          text(label, pos.x - labelWidth / 4, pos.y);

          textSize(10);
          textStyle(BOLD);

          if (pos.isGray) {
            fill(0); // Black color for exponents in gray boxes
          } else if (label.endsWith("s")) {
            fill(255, 0, 0);
          } else if (label.endsWith("p")) {
            fill(0, 255, 0); // Green color for p orbitals
          } else if (label.endsWith("d")) {
            fill(0, 0, 255);
          } else if (label.endsWith("f")) {
            fill(255, 165, 0);
          }

          text(exponent, pos.x + labelWidth / 4, pos.y - 8); // Move exponent 3 pixels higher
          fill(0);
          textStyle(NORMAL);
          textSize(12);
        } else {
          text(pos.label, pos.x, pos.y);
        }
      }
    }

    function drawArrows() {
      let grayArrowColor = color(150, 150, 150);
      stroke(grayArrowColor);
      strokeWeight(2);
      drawingContext.setLineDash([5, 5]); // Set dotted line
      for (let i = 0; i < fillOrder.length - 1; i++) {
        let idx1 = fillOrder[i];
        let idx2 = fillOrder[i + 1];
        let pos1 = positions[idx1];
        let pos2 = positions[idx2];
        if (pos2.y > pos1.y) {
          let startOffset = 13;
          let endOffset = 13;

          let x1 = pos1.x + boxWidth / 2;
          let y1 = pos1.y - boxHeight / 2 + startOffset;
          let x2 = pos2.x + boxWidth / 2;
          let y2 = pos2.y - boxHeight / 2 + endOffset;

          drawArrow(x1, y1, x2, y2);
        }
      }
      drawingContext.setLineDash([]); // Reset to solid line

      let redArrowColor = color(255, 0, 0);
      stroke(redArrowColor);
      strokeWeight(2);

      let lastFilledIndex = -1;
      for (let i = fillOrder.length - 1; i >= 0; i--) {
        let idx = fillOrder[i];
        if (positions[idx].filled > 0) {
          lastFilledIndex = i;
          break;
        }
      }

      for (let i = 0; i < lastFilledIndex; i++) {
<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aufbau</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body { text-align: center; font-family: Verdana, sans-serif; }
    canvas { display: block; margin: auto; }
    button { margin: 5px; padding: 10px 20px; font-size: 14px; }
    #infoTable {
      margin-top: 20px;
      font-size: 14px;
      font-weight: normal;
      border-collapse: collapse;
      width: 50%;
      margin-left: auto;
      margin-right: auto;
    }
    #infoTable th, #infoTable td {
      border: 1px solid black;
      padding: 8px;
      text-align: center;
    }
    #infoTable th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <h1>Aufbau</h1>
  <label for="atomicNumber">Ατομικός Αριθμός:</label>
  <input type="number" id="atomicNumber" min="1" max="118" value="1">
  <button onclick="startFilling()">Ξεκίνα Δόμηση</button>
  <button onclick="resetDiagram()">Reset</button>
  <div id="elementInfo"></div>
  <table id="infoTable">
    <tr>
      <td>Περίοδος</td>
      <td id="periodInfo"></td>
    </tr>
    <tr>
      <td>Ομάδα</td>
      <td id="groupInfo"></td>
    </tr>
    <tr>
      <td>Σύμβολο Στοιχείου</td>
      <td id="elementSymbol"></td>
    </tr>
    <tr>
      <td>Αρχικό aufbau</td>
      <td id="electronConfigInfo"></td>
    </tr>
  </table>

  <script>
    const elements = [
      { symbol: "H", name: "Υδρογόνο" },
      { symbol: "He", name: "Ήλιο" },
      { symbol: "Li", name: "Λίθιο" },
      { symbol: "Be", name: "Βηρύλλιο" },
      { symbol: "B", name: "Βόριο" },
      { symbol: "C", name: "Άνθρακας" },
      { symbol: "N", name: "Άζωτο" },
      { symbol: "O", name: "Οξυγόνο" },
      { symbol: "F", name: "Φθόριο" },
      { symbol: "Ne", name: "Νέον" },
      { symbol: "Na", name: "Νάτριο" },
      { symbol: "Mg", name: "Μαγνήσιο" },
      { symbol: "Al", name: "Αλουμίνιο" },
      { symbol: "Si", name: "Πυρίτιο" },
      { symbol: "P", name: "Φώσφορος" },
      { symbol: "S", name: "Θείο" },
      { symbol: "Cl", name: "Χλώριο" },
      { symbol: "Ar", name: "Αργό" },
      { symbol: "K", name: "Κάλιο" },
      { symbol: "Ca", name: "Ασβέστιο" },
      { symbol: "Sc", name: "Σκάνδιο" },
      { symbol: "Ti", name: "Τιτάνιο" },
      { symbol: "V", name: "Βανάδιο" },
      { symbol: "Cr", name: "Χρώμιο" },
      { symbol: "Mn", name: "Μαγγάνιο" },
      { symbol: "Fe", name: "Σίδηρος" },
      { symbol: "Co", name: "Κοβάλτιο" },
      { symbol: "Ni", name: "Νικέλιο" },
      { symbol: "Cu", name: "Χαλκός" },
      { symbol: "Zn", name: "Ψευδάργυρος" },
      { symbol: "Ga", name: "Γάλλιο" },
      { symbol: "Ge", name: "Γερμάνιο" },
      { symbol: "As", name: "Αρσενικό" },
      { symbol: "Se", name: "Σελήνιο" },
      { symbol: "Br", name: "Βρώμιο" },
      { symbol: "Kr", name: "Κρυπτό" },
      { symbol: "Rb", name: "Ρουβίδιο" },
      { symbol: "Sr", name: "Στρόντιο" },
      { symbol: "Y", name: "Ύττριο" },
      { symbol: "Zr", name: "Ζιρκόνιο" },
      { symbol: "Nb", name: "Νιόβιο" },
      { symbol: "Mo", name: "Μολυβδαίνιο" },
      { symbol: "Tc", name: "Τεχνήτιο" },
      { symbol: "Ru", name: "Ρουθήνιο" },
      { symbol: "Rh", name: "Ρόδιο" },
      { symbol: "Pd", name: "Παλλάδιο" },
      { symbol: "Ag", name: "Άργυρος" },
      { symbol: "Cd", name: "Κάδμιο" },
      { symbol: "In", name: "Ίνδιο" },
      { symbol: "Sn", name: "Κασσίτερος" },
      { symbol: "Sb", name: "Αντιμόνιο" },
      { symbol: "Te", name: "Τελλούριο" },
      { symbol: "I", name: "Ιώδιο" },
      { symbol: "Xe", name: "Ξένο" },
      { symbol: "Cs", name: "Καίσιο" },
      { symbol: "Ba", name: "Βάριο" },
      { symbol: "La", name: "Λανθάνιο" },
      { symbol: "Ce", name: "Κερίο" },
      { symbol: "Pr", name: "Πρασεοδύμιο" },
      { symbol: "Nd", name: "Νεοδύμιο" },
      { symbol: "Pm", name: "Προμήθιο" },
      { symbol: "Sm", name: "Σαμάριο" },
      { symbol: "Eu", name: "Ευρώπιο" },
      { symbol: "Gd", name: "Γαδολίνιο" },
      { symbol: "Tb", name: "Τέρβιο" },
      { symbol: "Dy", name: "Δυσπρόσιο" },
      { symbol: "Ho", name: "Όλμιο" },
      { symbol: "Er", name: "Έρβιο" },
      { symbol: "Tm", name: "Θούλιο" },
      { symbol: "Yb", name: "Υττέρβιο" },
      { symbol: "Lu", name: "Λουτέτσιο" },
      { symbol: "Hf", name: "Άφνιο" },
      { symbol: "Ta", name: "Ταντάλιο" },
      { symbol: "W", name: "Βολφράμιο" },
      { symbol: "Re", name: "Ρήνιο" },
      { symbol: "Os", name: "Όσμιο" },
      { symbol: "Ir", name: "Ιρίδιο" },
      { symbol: "Pt", name: "Πλατίνα" },
      { symbol: "Au", name: "Χρυσός" },
      { symbol: "Hg", name: "Υδράργυρος" },
      { symbol: "Tl", name: "Θάλλιο" },
      { symbol: "Pb", name: "Μόλυβδος" },
      { symbol: "Bi", name: "Βισμούθιο" },
      { symbol: "Po", name: "Πολώνιο" },
      { symbol: "At", name: "Άστατο" },
      { symbol: "Rn", name: "Ραδόνιο" },
      { symbol: "Fr", name: "Φράνκιο" },
      { symbol: "Ra", name: "Ράδιο" },
      { symbol: "Ac", name: "Ακτίνιο" },
      { symbol: "Th", name: "Θόριο" },
      { symbol: "Pa", name: "Πρωτακτίνιο" },
      { symbol: "U", name: "Ουράνιο" },
      { symbol: "Np", name: "Νεπτούνιο" },
      { symbol: "Pu", name: "Πλουτώνιο" },
      { symbol: "Am", name: "Αμερίκιο" },
      { symbol: "Cm", name: "Κουρίο" },
      { symbol: "Bk", name: "Μπερκέλιο" },
      { symbol: "Cf", name: "Καλιφόρνιο" },
      { symbol: "Es", name: "Αϊνστάινιο" },
      { symbol: "Fm", name: "Φέρμιο" },
      { symbol: "Md", name: "Μενδελέβιο" },
      { symbol: "No", name: "Νομπέλιο" },
      { symbol: "Lr", name: "Λωρένσιο" },
      { symbol: "Rf", name: "Ραδερφόρδιο" },
      { symbol: "Db", name: "Ντούμπνιο" },
      { symbol: "Sg", name: "Σίμποργκιο" },
      { symbol: "Bh", name: "Μποχρίο" },
      { symbol: "Hs", name: "Χάσιο" },
      { symbol: "Mt", name: "Μάιτνεριο" },
      { symbol: "Ds", name: "Νταρμστάντιο" },
      { symbol: "Rg", name: "Ρεντγκένιο" },
      { symbol: "Cn", name: "Κοπέρνικιο" },
      { symbol: "Nh", name: "Νιχόνιο" },
      { symbol: "Fl", name: "Φλερόβιο" },
      { symbol: "Mc", name: "Μοσκόβιο" },
      { symbol: "Lv", name: "Λιβερμόριο" },
      { symbol: "Ts", name: "Τενεσσίνο" },
      { symbol: "Og", name: "Ογκανέσσιο" }
    ];

    const periods = [
      { label: "K", orbitals: ["1s"] },
      { label: "L", orbitals: ["2s", "2p"] },
      { label: "M", orbitals: ["3s", "3p", "3d"] },
      { label: "N", orbitals: ["4s", "4p", "4d", "4f"] },
      { label: "O", orbitals: ["5s", "5p", "5d", "5f"] },
      { label: "P", orbitals: ["6s", "6p", "6d"] },
      { label: "Q", orbitals: ["7s", "7p"] }
    ];

    const maxElectrons = { "s": 2, "p": 6, "d": 10, "f": 14 };
    const boxWidth = 60, boxHeight = 40, verticalSpacing = 45;
    const horizontalGap = 5;
    const canvasWidth = 800, canvasHeight = 500;
    const leftMargin = 120;
    const periodLabelWidth = 50;
    const fillOrder = [0, 1, 2, 3, 4, 6, 5, 7, 10, 8, 11, 14, 9, 12, 15, 17, 13, 16, 18];

    let positions = [];
    let columnColors = [];
    let lastFilledS = null;
    let lastFilledP = null;
    let lastPeriod = -1;

    function setup() {
      createCanvas(canvasWidth, canvasHeight);
      textSize(12);
      textFont("Verdana");
      initColumnColors();
      calculatePositions();
      noLoop();
    }

    function draw() {
      background(255);
      drawPeriodLabels();
      drawOrbitals();
      drawArrows();
    }

    function initColumnColors() {
      columnColors = [
        color("#FFCDD2"), // στήλη 0
        color("#C8E6C9"), // στήλη 1
        color("#BBDEFB"), // στήλη 2
        color("#FFF9C4"), // στήλη 3
        color("#D1C4E9")  // στήλη 4
      ];
    }

    function calculatePositions() {
      positions = [];
      let startY = 50;
      for (let i = 0; i < periods.length; i++) {
        let rowOrbitals = periods[i].orbitals;
        let startX = leftMargin + periodLabelWidth;
        let y = startY + i * verticalSpacing;
        for (let j = 0; j < rowOrbitals.length; j++) {
          let x = startX + j * (boxWidth + horizontalGap);
          positions.push({ x: x, y: y, label: rowOrbitals[j], filled: 0, col: j });
        }
      }
    }

    function drawPeriodLabels() {
      let periodElectrons = new Array(periods.length).fill(0);
      for (let pos of positions) {
        let periodIndex = periods.findIndex(p => p.orbitals.includes(pos.label));
        if (periodIndex !== -1) {
          periodElectrons[periodIndex] += pos.filled;
        }
      }

      textAlign(RIGHT, CENTER);
      fill(0);
      textSize(14);
      textStyle(BOLD);
      for (let i = 0; i < periods.length; i++) {
        let y = 50 + i * verticalSpacing;
        if (periodElectrons[i] > 0) {
          text(periods[i].label + " (" + periodElectrons[i] + ")", leftMargin - 10, y);
        } else {
          text(periods[i].label, leftMargin - 10, y);
        }
      }
      textStyle(NORMAL);
      textSize(12);
    }

    function drawOrbitals() {
      noStroke();
      textAlign(CENTER, CENTER);
      for (let pos of positions) {
        let colIndex = pos.col;
        let colColor = columnColors[colIndex % columnColors.length];

        // Change color to gray for the last filled s and p orbitals of the last period
        if (pos.isGray) {
          colColor = color(200); // Gray color
        }

        fill(colColor);
        rectMode(CENTER);
        rect(pos.x, pos.y, boxWidth, boxHeight);
        fill(0);

        if (pos.filled > 0) {
          let label = pos.label;
          let exponent = pos.filled;
          let labelWidth = textWidth(label);

          text(label, pos.x - labelWidth / 4, pos.y);

          textSize(10);
          textStyle(BOLD);

          if (pos.isGray) {
            fill(0); // Black color for exponents in gray boxes
          } else if (label.endsWith("s")) {
            fill(255, 0, 0);
          } else if (label.endsWith("p")) {
            fill(0, 255, 0); // Green color for p orbitals
          } else if (label.endsWith("d")) {
            fill(0, 0, 255);
          } else if (label.endsWith("f")) {
            fill(255, 165, 0);
          }

          text(exponent, pos.x + labelWidth / 4, pos.y - 8); // Move exponent 3 pixels higher
          fill(0);
          textStyle(NORMAL);
          textSize(12);
        } else {
          text(pos.label, pos.x, pos.y);
        }
      }
    }

    function drawArrows() {
      let grayArrowColor = color(150, 150, 150);
      stroke(grayArrowColor);
      strokeWeight(2);
      drawingContext.setLineDash([5, 5]); // Set dotted line
      for (let i = 0; i < fillOrder.length - 1; i++) {
        let idx1 = fillOrder[i];
        let idx2 = fillOrder[i + 1];
        let pos1 = positions[idx1];
        let pos2 = positions[idx2];
        if (pos2.y > pos1.y) {
          let startOffset = 13;
          let endOffset = 13;

          let x1 = pos1.x + boxWidth / 2;
          let y1 = pos1.y - boxHeight / 2 + startOffset;
          let x2 = pos2.x + boxWidth / 2;
          let y2 = pos2.y - boxHeight / 2 + endOffset;

          drawArrow(x1, y1, x2, y2);
        }
      }
      drawingContext.setLineDash([]); // Reset to solid line

      let redArrowColor = color(255, 0, 0);
      stroke(redArrowColor);
      strokeWeight(2);

      let lastFilledIndex = -1;
      for (let i = fillOrder.length - 1; i >= 0; i--) {
        let idx = fillOrder[i];
        if (positions[idx].filled > 0) {
          lastFilledIndex = i;
          break;
        }
      }

      for (let i = 0; i < lastFilledIndex; i++) {
